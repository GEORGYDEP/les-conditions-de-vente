<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices Comptabilit√© - Conditions de Vente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Suppression des fl√®ches dans les input number pour un design plus propre */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- DATA ---
        const analysisExercises = [
            {
                id: 1,
                title: "Analyse 1 : OfficePro.be",
                conditions: {
                    name: "OfficePro.be",
                    prix: "Tous nos prix s'entendent HTVA (TVA 21% non incluse).",
                    livraison: "Franco domicile d√®s 75 ‚Ç¨ d'achat. Frais de port forfaitaires de 6,50 ‚Ç¨ pour toute commande inf√©rieure.",
                    delai: "Livraison sous 24h √† 48h ouvrables.",
                    paiement: "Bancontact, Carte de Cr√©dit, PayPal. Facturation √† 30 jours pour les administrations publiques.",
                    reductions: "Remise de 15% pour toute commande de plus de 500 unit√©s. Escompte de 3% pour paiement au grand comptant (√† la r√©ception).",
                    reclamations: "Toute r√©clamation doit √™tre introduite par √©crit dans les 5 jours suivant la livraison."
                },
                questions: [
                    { id: 1, text: "Quelles sont les conditions de livraison ? Explique.", correctAnswer: "Franco (gratuit) si la commande est ‚â• 75 ‚Ç¨. Sinon, 6,50 ‚Ç¨ de frais de port. D√©lai : 24-48h." },
                    { id: 2, text: "Une √©cole commande pour 60 ‚Ç¨ de mat√©riel. Quel sera le montant des frais de livraison ?", correctAnswer: "6,50 ‚Ç¨ car le montant est inf√©rieur au seuil de 75 ‚Ç¨." },
                    { id: 3, text: "Un client paie sa facture d√®s r√©ception. De quelle r√©duction peut-il b√©n√©ficier ?", correctAnswer: "Un escompte de 3% (paiement au grand comptant)." }
                ]
            },
            {
                id: 2,
                title: "Analyse 2 : ElectroTech Express",
                conditions: {
                    name: "ElectroTech Express",
                    prix: "Prix nets TVAC affich√©s.",
                    livraison: "Livraison standard 4,90 ‚Ç¨. Franco de port √† partir de 150 ‚Ç¨ d'achat.",
                    delai: "Exp√©dition le jour m√™me pour toute commande pass√©e avant 12h.",
                    paiement: "Virement bancaire ou esp√®ces en magasin. Professionnels : paiement √† 30 jours date de facture.",
                    reductions: "Remise fid√©lit√© de 5% d√®s le 3√®me achat annuel. Escompte de 1% pour paiement sous 10 jours.",
                    reclamations: "Signalement des avaries de transport end√©ans les 48 heures."
                },
                questions: [
                    { id: 1, text: "√Ä partir de quel montant la livraison devient-elle gratuite ?", correctAnswer: "√Ä partir de 150 ‚Ç¨ d'achat." },
                    { id: 2, text: "Quelle est l'√©ch√©ance de paiement pour un client professionnel ?", correctAnswer: "30 jours apr√®s la date de la facture." },
                    { id: 3, text: "Un client paie le 5√®me jour. Quel avantage financier obtient-il ?", correctAnswer: "Un escompte de 1% (car paiement effectu√© sous 10 jours)." }
                ]
            }
        ];

        const calculationExercises = [
            {
                id: 1,
                title: "Calcul 1 : Librairie du Centre",
                companyName: "Librairie du Centre (SRL)",
                supplierName: "Papeterie Gros",
                items: [{ label: "Ramettes de papier A4", quantity: 80, unitPrice: 4.50 }],
                remiseRate: 10,
                remiseThreshold: 300,
                escompteRate: 2,
                escompteDays: 8
            },
            {
                id: 2,
                title: "Calcul 2 : Garage du Midi",
                companyName: "Garage du Midi",
                supplierName: "Pneus-Direct",
                items: [{ label: "Pneus √©t√© 205/55 R16", quantity: 12, unitPrice: 95.00 }],
                remiseRate: 5,
                remiseThreshold: 1000,
                escompteRate: 3,
                escompteDays: 5
            }
        ];

        // --- COMPONENTS ---

        const AnalysisExercise = ({ data }) => {
            const [userAnswers, setUserAnswers] = useState({});
            const [submitted, setSubmitted] = useState({});

            const toggleSubmit = (id) => setSubmitted(prev => ({ ...prev, [id]: !prev[id] }));

            return (
                <div className="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden mb-10 animate-fadeIn">
                    <div className="bg-amber-600 px-6 py-4 text-white font-bold text-xl flex items-center gap-2">
                        <span>üîç</span> {data.title}
                    </div>
                    <div className="p-6">
                        <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-5 mb-8">
                            <h3 className="text-center font-bold text-lg mb-4 underline uppercase text-amber-900 tracking-wide">{data.conditions.name} - CGV</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-y-3 gap-x-6 text-sm text-slate-700 leading-relaxed">
                                <p><strong>üí∞ Prix :</strong> {data.conditions.prix}</p>
                                <p><strong>üöö Livraison :</strong> {data.conditions.livraison}</p>
                                <p><strong>‚è±Ô∏è D√©lai :</strong> {data.conditions.delai}</p>
                                <p><strong>üí≥ Paiement :</strong> {data.conditions.paiement}</p>
                                <p><strong>üìâ R√©ductions :</strong> {data.conditions.reductions}</p>
                                <p><strong>üìù R√©clamations :</strong> {data.conditions.reclamations}</p>
                            </div>
                        </div>
                        <div className="space-y-6">
                            {data.questions.map((q, idx) => (
                                <div key={q.id} className="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <p className="font-semibold text-slate-800 mb-3 flex gap-2">
                                        <span className="bg-slate-200 text-slate-600 rounded-full w-6 h-6 flex items-center justify-center text-xs">{idx + 1}</span>
                                        {q.text}
                                    </p>
                                    <textarea
                                        disabled={submitted[q.id]}
                                        className={`w-full p-3 border-2 rounded-lg outline-none text-sm transition-all ${submitted[q.id] ? 'bg-gray-100 border-gray-200 text-gray-500' : 'bg-white border-slate-200 focus:border-blue-500 text-slate-800'}`}
                                        placeholder="Votre r√©ponse..."
                                        rows="2"
                                        value={userAnswers[q.id] || ''}
                                        onChange={(e) => setUserAnswers({...userAnswers, [q.id]: e.target.value})}
                                    />
                                    <button
                                        onClick={() => toggleSubmit(q.id)}
                                        className={`mt-3 px-4 py-2 rounded text-xs font-bold uppercase tracking-wider transition-colors ${submitted[q.id] ? 'bg-slate-400 hover:bg-slate-500 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                                    >
                                        {submitted[q.id] ? "Modifier ma r√©ponse" : "Valider et voir la solution"}
                                    </button>
                                    {submitted[q.id] && (
                                        <div className="mt-4 p-3 bg-green-50 border-l-4 border-green-500 text-green-900 text-sm animate-fadeIn">
                                            <strong>‚úÖ Solution :</strong> <span className="italic">{q.correctAnswer}</span>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const CalculationExercise = ({ data }) => {
            const initialInputs = { gross: '', remise: '', netCom: '', escompte: '', final: '' };
            const [inputs, setInputs] = useState(initialInputs);
            const [validated, setValidated] = useState(false);

            // Calculs automatiques pour la correction
            const calcs = useMemo(() => {
                const gross = data.items.reduce((acc, i) => acc + (i.quantity * i.unitPrice), 0);
                // Si le montant brut est strictment sup√©rieur au seuil
                const remise = gross > data.remiseThreshold ? (gross * data.remiseRate / 100) : 0;
                const netCom = gross - remise;
                const escompte = (netCom * data.escompteRate / 100);
                const final = netCom - escompte;
                return { gross, remise, netCom, escompte, final };
            }, [data]);

            const check = (field) => {
                if (!validated) return "border-slate-300 focus:border-indigo-500";
                
                // Gestion des virgules et points pour les nombres
                const valStr = inputs[field] ? inputs[field].replace(',', '.') : "0";
                const userVal = parseFloat(valStr);
                
                if (isNaN(userVal)) return "border-red-500 bg-red-50";

                // Tol√©rance de 0.05 centime
                const isCorrect = Math.abs(userVal - calcs[field]) < 0.05;
                return isCorrect ? "border-green-500 bg-green-50 text-green-700 font-semibold" : "border-red-500 bg-red-50 text-red-700";
            };

            const handleAction = () => {
                if (validated) {
                    // Si on clique sur recommencer, on vide tout
                    setInputs(initialInputs);
                    setValidated(false);
                } else {
                    // Sinon on valide
                    setValidated(true);
                }
            };

            const format = (v) => new Intl.NumberFormat('fr-BE', { style: 'currency', currency: 'EUR' }).format(v);

            return (
                <div className="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden mb-10 animate-fadeIn">
                    <div className="bg-indigo-700 px-6 py-4 text-white font-bold text-xl flex items-center gap-2">
                        <span>üßÆ</span> {data.title}
                    </div>
                    <div className="p-6">
                        <div className="bg-slate-800 text-white p-5 rounded-xl mb-6 shadow-inner">
                            <p className="mb-2 text-lg">
                                <span className="font-bold text-indigo-300">{data.companyName}</span> ach√®te chez <span className="font-bold text-indigo-300">{data.supplierName}</span> :
                            </p>
                            <ul className="list-disc ml-6 text-slate-200 mb-4">
                                {data.items.map((i, idx) => (
                                    <li key={idx}>
                                        <span className="font-mono bg-slate-700 px-1 rounded text-yellow-300">{i.quantity}</span> x {i.label} √† <span className="font-mono bg-slate-700 px-1 rounded text-yellow-300">{format(i.unitPrice)}</span>
                                    </li>
                                ))}
                            </ul>
                            <div className="bg-slate-700/50 p-3 rounded border border-slate-600 text-sm italic text-slate-300 flex flex-wrap gap-4">
                                <span>üè∑Ô∏è Remise : <strong>{data.remiseRate}%</strong> (si &gt; {format(data.remiseThreshold)})</span>
                                <span>‚ö° Escompte : <strong>{data.escompteRate}%</strong> ({data.escompteDays} jours)</span>
                            </div>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse min-w-[300px]">
                                <thead className="bg-slate-100 uppercase text-[10px] font-bold text-slate-500 tracking-wider">
                                    <tr>
                                        <th className="p-3 text-left">Libell√©</th>
                                        <th className="p-3 text-right">Votre calcul (‚Ç¨)</th>
                                        {validated && <th className="p-3 text-right bg-indigo-50 text-indigo-700 animate-fadeIn">Correction</th>}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {[
                                        { key: 'gross', label: 'Prix Brut Total' },
                                        { key: 'remise', label: `Remise (${data.remiseRate}%)` },
                                        { key: 'netCom', label: 'Net Commercial' },
                                        { key: 'escompte', label: `Escompte (${data.escompteRate}%)` },
                                        { key: 'final', label: 'NET √Ä PAYER' }
                                    ].map((row) => (
                                        <tr key={row.key} className={row.key === 'final' ? 'bg-indigo-50/50 font-bold' : 'hover:bg-slate-50'}>
                                            <td className="p-3 text-sm text-slate-700">{row.label}</td>
                                            <td className="p-3 text-right">
                                                <input
                                                    type="text"
                                                    inputMode="decimal"
                                                    placeholder="0,00"
                                                    className={`w-32 p-2 text-right border-2 rounded outline-none transition-all ${check(row.key)}`}
                                                    value={inputs[row.key]}
                                                    onChange={e => setInputs({...inputs, [row.key]: e.target.value})}
                                                />
                                            </td>
                                            {validated && (
                                                <td className="p-3 text-right text-sm font-bold text-indigo-700 bg-indigo-50 animate-fadeIn">
                                                    {format(calcs[row.key])}
                                                </td>
                                            )}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        <div className="mt-8 flex justify-center">
                            <button
                                onClick={handleAction}
                                className={`px-8 py-3 rounded-full font-bold shadow-lg transform transition-all hover:scale-105 active:scale-95 ${
                                    validated 
                                    ? "bg-slate-600 hover:bg-slate-700 text-white" 
                                    : "bg-green-600 hover:bg-green-700 text-white"
                                }`}
                            >
                                {validated ? "üîÑ Recommencer l'exercice" : "‚úÖ V√©rifier mes calculs"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [tab, setTab] = useState('analysis');
            return (
                <div className="max-w-3xl mx-auto px-4 py-12">
                    <header className="mb-12 text-center animate-fadeIn">
                        <div className="inline-block p-2 bg-blue-100 text-blue-700 rounded-full mb-4 text-xs font-bold uppercase tracking-widest">Exercices interactifs</div>
                        <h1 className="text-4xl md:text-5xl font-extrabold text-slate-800 mb-3 tracking-tight">Comptabilit√© : Fiche 5</h1>
                        <p className="text-slate-500 text-lg">Ma√Ætriser les conditions de vente et le calcul du prix net</p>
                    </header>
                    
                    <nav className="flex gap-2 p-1 bg-white rounded-full shadow-sm border border-slate-200 mb-8 mx-auto max-w-md">
                        <button 
                            onClick={() => setTab('analysis')} 
                            className={`flex-1 px-6 py-2 rounded-full text-sm font-bold transition-all ${tab === 'analysis' ? 'bg-amber-500 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                        >
                            Analyse CGV
                        </button>
                        <button 
                            onClick={() => setTab('calculation')} 
                            className={`flex-1 px-6 py-2 rounded-full text-sm font-bold transition-all ${tab === 'calculation' ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                        >
                            Calculs
                        </button>
                    </nav>

                    <div>
                        {tab === 'analysis' 
                            ? analysisExercises.map(ex => <AnalysisExercise key={ex.id} data={ex} />) 
                            : calculationExercises.map(ex => <CalculationExercise key={ex.id} data={ex} />)
                        }
                    </div>

                    <footer className="text-center text-slate-400 text-sm mt-12 pb-8">
                        Exercices de r√©vision - Comptabilit√©
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
